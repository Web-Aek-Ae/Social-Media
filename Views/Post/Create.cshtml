@model SocialMedia.ViewModels.PostViewModel


@{
    Layout = "~/Views/Shared/_LayoutEditPost.cshtml";
}

<head>
    <link rel="stylesheet" href="~/css/post.css">
</head>
<div>
    <a asp-action="Post" asp-controller="Profile">
        <img src="~/src/images/Backicon.svg" class="back">
    </a>
    <div class="box">
        <div class="title-header">
            <div class="title">
                <img src="@ViewData["UserImage"]"
                    class="profile">
                <input asp-for="Title" placeholder="Event Name" class="name">
            </div>
                @if(Model.Group != null){
            <div class="group-name">
                    <h3>@Model.Group.Name</h3>
                    <input type="text" asp-for="GroupId" style=" display : none;">
            </div>
                }
        </div>

        <textarea asp-for="Content" placeholder="description..."></textarea>

        <h1>Details</h1>
        <div class="details">
            <!-- Category selection -->
            <div class="boxinput">
                <img src="@Url.Content("~/src/images/CategoriesIcon.svg")">
                <div class="item">
                    <label for="SelectedCategoryId">Category:</label>
                    <select asp-for="SelectedCategoryId" asp-items="@Model.Categories" class="input">
                    </select>
                </div>
            </div>

            <div class="boxinput">
                <img src="@Url.Content("~/src/images/Dateicon.svg")">
                <div class="item">
                    <label for="Date">Date :</label>
                    <input asp-for="Date" placeholder="Pick a date..." type="date" class="input">
                </div>

            </div>
            <div class="boxinput"><img src="@Url.Content("~/src/images/Locationicon.svg")">
                <div class="item">
                    <label for="Location">Location :</label>
                    <input asp-for="Location" placeholder="Location" class="input">
                </div>

            </div>
            <div class="boxinput"><img src="~/src/images/Timeicon.svg">
                <div class="item">
                    <label for="Time">Time :</label>
                    <input asp-for="Time" placeholder="What time ?" type="time" class="input">
                </div>
            </div>
            <div class="boxinput"><img src="~/src/images/Expireicon.svg">
                <div class="item">
                    <label for="ExpireDate">Expire Date :</label>
                    <input asp-for="ExpireDate" placeholder="Expire date" type="date" class="input">
                </div>

            </div>
            <div class="boxinput"><img src="~/src/images/Imgicon.svg">
                <div class="item">
                    <label for="Image">Image :</label>
                    <input asp-for="Image" placeholder="Add some photos" class="input">
                </div>

            </div>
            <div class="boxinput"><img src="/src/images/Peopleicon.svg">
                <div class="item">
                    <label for="MaxPeople">Max People :</label>
                    <input asp-for="MaxPeople" placeholder="Max people" type="number" class="input">
                </div>
            </div>
        </div>

        <div class="btn">
            <button asp-action="Post" asp-controller="Profile">Post</button>
        </div>
    </div>
</div>
@section scripts {
    <script>
        $(document).ready(function () {
            $(".btn button").click(function (event) {
                event.preventDefault(); // Prevent the default form submission

                var formData = {
                    Title: document.querySelector('input[name="Title"]').value,
                    Content: document.querySelector('textarea[name="Content"]').value,
                    Date: document.querySelector('input[name="Date"]').value,
                    Location: document.querySelector('input[name="Location"]').value,
                    SelectedCategoryId: document.querySelector('select[name="SelectedCategoryId"]').value,
                    Time: document.querySelector('input[name="Time"]').value,
                    ExpireDate: document.querySelector('input[name="ExpireDate"]').value,
                    Image: document.querySelector('input[name="Image"]').value,
                    MaxPeople: parseInt(document.querySelector('input[name="MaxPeople"]').value, 10),
                    GroupId: document.querySelector('input[name="GroupId"]') ? parseInt(document.querySelector('input[name="GroupId"]').value, 10) : null
                };

                // Basic validation example
                if (!formData.Title || !formData.Content) {
                    alert("Title and Content are required.");
                    return; // Exit the function to prevent sending the request
                }

                var xhr = new XMLHttpRequest();
                xhr.open("POST", '@Url.Action("CreatePost", "Post")', true); // Modify with your correct URL
                xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                @* xhr.setRequestHeader("Authorization", "Bearer " + jwt); *@
                xhr.onload = function () {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        var response = JSON.parse(xhr.responseText);
                        if (response.success) {
                            alert("Post created successfully.");
                            // Optionally, redirect or clear form here
                            window.location.href = '/Home/Index'; // Adjust controller and action names as necessary
                        } else {
                            alert("Failed to create post: " + response.message);
                        }
                    } else {
                        alert("There was an error processing your request.");
                        console.log(xhr.responseText);
                    }
                }; xhr.onerror = function () {
                    console.error("An error occurred during the transaction");
                };

                xhr.send(JSON.stringify(formData));

            });
        });
    </script>
}